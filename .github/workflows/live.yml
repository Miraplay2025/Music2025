name: Live Config

on:
  workflow_dispatch:
    inputs:
      stream_url:
        description: 'URL do Stream'
        required: true
        default: ''
      arquivos:
        description: 'Lista de arquivos'
        required: true
        default: ''
      rclone_conf:
        description: 'rclone.conf em Base64'
        required: true
        default: ''

jobs:
  run_live:
    runs-on: ubuntu-latest
    steps:
      - name: Exibir dados da Live
        run: |
          echo "üîó URL Stream: ${{ github.event.inputs.stream_url }}"
          echo "üìÑ Caminhos dos arquivos:"
          echo "${{ github.event.inputs.arquivos }}"
          echo "üîê rclone.conf (Base64):"
          echo "${{ github.event.inputs.rclone_conf }}"

      - name: Decodificar rclone.conf e exibir
        run: |
          echo "${{ github.event.inputs.rclone_conf }}" | base64 -d > rclone.conf
          echo "üìÅ Conte√∫do decodificado do rclone.conf:"
          cat rclone.conf

  montar-video:
    runs-on: ubuntu-latest
    needs: run_live
    steps:
      - name: üì• Clonar reposit√≥rio
        uses: actions/checkout@v4

      - name: üì¶ Instalar depend√™ncias
        run: |
          sudo apt update
          sudo apt install -y ffmpeg jq rclone git curl
          echo '{}' > package.json
          npm install puppeteer

      - name: üìÑ Salvar rclone.conf
        run: |
          mkdir -p ~/.config/rclone
          echo "${{ github.event.inputs.rclone_conf }}" | base64 -d > ~/.config/rclone/rclone.conf

      - name: üìù Criar input.json para o script JS
        run: |
          echo "{\"stream_url\": \"${{ github.event.inputs.stream_url }}\", \"arquivos\": \"${{ github.event.inputs.arquivos }}\"}" > input.json

      - name: ‚ñ∂Ô∏è Executar Music_unir.js
        run: |
          node Music_unir.js
