  montar-video:
    runs-on: ubuntu-latest
    needs: run_live
    steps:
      - name: ğŸ“¥ Clonar repositÃ³rio
        uses: actions/checkout@v4

      - name: ğŸ“¦ Instalar dependÃªncias
        run: |
          sudo apt update
          sudo apt install -y ffmpeg jq rclone git curl
          echo '{}' > package.json

      - name: ğŸ“„ Salvar rclone.conf
        run: |
          mkdir -p ~/.config/rclone
          echo "${{ github.event.inputs.rclone_conf }}" | base64 -d > ~/.config/rclone/rclone.conf

      - name: ğŸ“ Criar input.json para o script JS
        run: |
          echo "{\"stream_url\": \"${{ github.event.inputs.stream_url }}\", \"arquivos\": \"${{ github.event.inputs.arquivos }}\"}" > input.json

      - name: â–¶ï¸ Executar Music_unir.js
        id: executar_js
        run: |
          set -e
          node Music_unir.js

      - name: ğŸ“¤ Enviar vÃ­deo final como artefato
        if: success()
        uses: actions/upload-artifact@v4
        with:
          name: video_final
          path: saida/video_final.mp4

      - name: ğŸ§¹ Limpeza final
        if: always()
        run: |
          echo ""
          echo "ğŸ§¹ Limpando arquivos temporÃ¡rios..."

          rm -rf temp/ saida/ input.json rclone.conf
          echo "ğŸ—‘ï¸ Arquivos removidos."

          if [ "${{ steps.executar_js.outcome }}" = "success" ]; then
            echo "âœ… Processo concluÃ­do com sucesso!"
          else
            echo "âŒ Ocorreu um erro durante o processamento."
          fi
        
