name: Processar Live Config

on:
  push:
    branches:
      - main
    paths:
      - data/live.yml

jobs:
  process_live_config:
    runs-on: ubuntu-latest

    steps:
      - name: Baixar c√≥digo do reposit√≥rio
        uses: actions/checkout@v3

      - name: Mostrar conte√∫do completo do live.yml
        run: |
          echo "üìÑ Conte√∫do bruto do arquivo data/live.yml:"
          echo "---------------------------------------------"
          cat data/live.yml
          echo "---------------------------------------------"

      - name: Extrair e decodificar rclone_conf
        run: |
          echo "üîç Extraindo campo 'rclone_conf' do arquivo..."

          # Extrai apenas o valor base64 (assume que est√° em uma linha)
          RCLONE_B64=$(grep '^rclone_conf:' data/live.yml | sed 's/^rclone_conf:[[:space:]]*//')

          echo
          echo "üì¶ Base64 extra√≠do:"
          echo "$RCLONE_B64"

          echo
          echo "üîì Conte√∫do decodificado (rclone.conf):"
          echo "---------------------------------------------"
          echo "$RCLONE_B64" | base64 --decode || echo "‚ùå Falha ao decodificar"
          echo "---------------------------------------------"
