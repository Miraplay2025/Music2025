  montar-video:
    runs-on: ubuntu-latest
    needs: run_live
    steps:
      - name: 📥 Clonar repositório
        uses: actions/checkout@v4

      - name: 📦 Instalar dependências
        run: |
          sudo apt update
          sudo apt install -y ffmpeg jq rclone git curl
          echo '{}' > package.json

      - name: 📄 Salvar rclone.conf
        run: |
          mkdir -p ~/.config/rclone
          echo "${{ github.event.inputs.rclone_conf }}" | base64 -d > ~/.config/rclone/rclone.conf

      - name: 📝 Criar input.json para o script JS
        run: |
          echo "{\"stream_url\": \"${{ github.event.inputs.stream_url }}\", \"arquivos\": \"${{ github.event.inputs.arquivos }}\"}" > input.json

      - name: ▶️ Executar Music_unir.js
        id: executar_js
        run: |
          set -e
          node Music_unir.js

      - name: 📤 Enviar vídeo final como artefato
        if: success()
        uses: actions/upload-artifact@v4
        with:
          name: video_final
          path: saida/video_final.mp4

      - name: 🧹 Limpeza final
        if: always()
        run: |
          echo ""
          echo "🧹 Limpando arquivos temporários..."

          rm -rf temp/ saida/ input.json rclone.conf
          echo "🗑️ Arquivos removidos."

          if [ "${{ steps.executar_js.outcome }}" = "success" ]; then
            echo "✅ Processo concluído com sucesso!"
          else
            echo "❌ Ocorreu um erro durante o processamento."
          fi
        
